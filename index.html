<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Table Tennis Game - Game Over and Speed by Difficulty</title>
  <style>
    body { background: #222; display: flex; flex-direction: column; align-items: center; height: 100vh; margin: 0;}
    #game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative; /* This will anchor absolute children */
    }
    canvas { background: #fff; display: block; }
    #difficulty {
      margin: 1em;
      font-size: 1.2em;
      padding: 0.4em 0.6em;
      border-radius:5px;
      border: none;
    }
    label {
      color: #fff;
      font-family: sans-serif;
      font-size: 1em;
    }
    #game-over {
      position: absolute;
      top: 60px;
      left: 0;
      width: 600px;
      height: 400px;
      background: rgba(0,0,0,0.85);
      display: none;
      color: #fff;
      padding: 2em 1em 1em;
      border-radius: 12px;
      font-size: 2em;
      text-align: center;
      z-index: 10;
      font-family: sans-serif;
      align-items: center;
      justify-content: center;
    }
    #restart-btn {
      font-size: 1em;
      padding: 0.35em 1.3em;
      border-radius: 8px;
      margin-top: 1em;
      background: #2e8b57;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    #missed-counter {
      color: #fff;
      font-family: sans-serif;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
<div id="game-container">
  <label for="difficulty">Select Difficulty: </label>
  <select id="difficulty">
    <option value="easy">Easy</option>
    <option value="medium" selected>Medium</option>
    <option value="hard">Hard</option>
  </select>
  <div id="missed-counter">Missed: 0 / 10</div>
  <canvas id="pong" width="600" height="400"></canvas>
  <div id="game-over">
    <div id="game-over-msg">Game Over!<br>You missed too many times.</div>
    <button id="restart-btn">Restart</button>
  </div>
</div>
<script>
const canvas = document.getElementById('pong');
const ctx = canvas.getContext('2d');
const selectDifficulty = document.getElementById('difficulty');
const missedCounter = document.getElementById('missed-counter');
const gameOverDiv = document.getElementById('game-over');
const restartBtn = document.getElementById('restart-btn');
const gameOverMsg = document.getElementById('game-over-msg');

// Paddle
const paddleWidth = 10, paddleHeight = 70, paddleSpeed = 6;
let leftY, rightY;

// Ball
let ballX, ballY, ballRadius = 8, ballSpeedX, ballSpeedY;

// Controls
let upPressed = false, downPressed = false;

// AI and miss/ball speed for each difficulty
const difficultySettings = {
  easy:   { aiSpeed: 2,   maxMisses: 20, ballSpeed: 3 },
  medium: { aiSpeed: 4,   maxMisses: 10, ballSpeed: 5 },
  hard:   { aiSpeed: 6,   maxMisses: 5,  ballSpeed: 8 }
};
let currentDifficulty = 'medium'; // default
let running = true;
let missed = 0;
let maxMisses = 10;
let ballSpeedSetting = 5;

function resetPositions(randomDir = true) {
  leftY = canvas.height/2 - paddleHeight/2;
  rightY = canvas.height/2 - paddleHeight/2;
  ballX = canvas.width/2;
  ballY = canvas.height/2;
  // set ball speed and direction
  let bs = ballSpeedSetting;
  let directionX = (randomDir ? (Math.random() > 0.5 ? 1 : -1) : 1);
  let directionY = (Math.random() > 0.5 ? 1 : -1);
  ballSpeedX = bs * directionX;
  ballSpeedY = bs * directionY;
}

function moveAI() {
  let aiSpeed = difficultySettings[currentDifficulty].aiSpeed;
  let paddleMid = rightY + paddleHeight/2;
  if (paddleMid < ballY - 10)
    rightY += aiSpeed;
  else if (paddleMid > ballY + 10)
    rightY -= aiSpeed;
  rightY = Math.max(0, Math.min(canvas.height - paddleHeight, rightY));
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Middle line
  ctx.fillStyle = "#ccc";
  ctx.fillRect(canvas.width/2-1, 0, 2, canvas.height);

  // Left Paddle (Player)
  ctx.fillStyle = "#2e8b57";
  ctx.fillRect(10, leftY, paddleWidth, paddleHeight);

  // Right Paddle (AI)
  ctx.fillStyle = "#c0392b";
  ctx.fillRect(canvas.width-20, rightY, paddleWidth, paddleHeight);

  // Ball
  ctx.beginPath();
  ctx.arc(ballX, ballY, ballRadius, 0, Math.PI*2);
  ctx.fillStyle = "#444";
  ctx.fill();
  ctx.closePath();
}

function update() {
  // Move player paddle
  if (upPressed && leftY > 0) leftY -= paddleSpeed;
  if (downPressed && leftY < canvas.height-paddleHeight) leftY += paddleSpeed;

  moveAI();

  // Move ball
  ballX += ballSpeedX;
  ballY += ballSpeedY;

  // Collision with top/bottom
  if (ballY-ballRadius < 0 || ballY+ballRadius > canvas.height)
    ballSpeedY = -ballSpeedY;

  // Left paddle collision
  if (
    ballX-ballRadius < 20 &&
    ballY > leftY &&
    ballY < leftY+paddleHeight &&
    ballSpeedX < 0
  ) {
    ballSpeedX = -ballSpeedX;
    ballX = 20+ballRadius; // Prevent sticking
  }

  // Right paddle collision
  if (
    ballX+ballRadius > canvas.width-20 &&
    ballY > rightY &&
    ballY < rightY+paddleHeight &&
    ballSpeedX > 0
  ) {
    ballSpeedX = -ballSpeedX;
    ballX = canvas.width-20-ballRadius; // Prevent sticking
  }

  // Missed (ball goes past player)
  if (ballX-ballRadius < 0) {
    missed += 1;
    missedCounter.textContent = `Missed: ${missed} / ${maxMisses}`;
    if (missed >= maxMisses) {
      showGameOver();
      return;
    }
    resetPositions();
  }

  // AI missed (not counted)
  if (ballX+ballRadius > canvas.width) {
    resetPositions();
  }
}

function showGameOver() {
  running = false;
  gameOverMsg.innerHTML = `Game Over!<br>You missed ${missed} times.<br>Press "Restart" or Space to try again.`;
  gameOverDiv.style.display = "flex";
}

function hideGameOver() {
  gameOverDiv.style.display = "none";
}

function resetGame() {
  missed = 0;
  maxMisses = difficultySettings[currentDifficulty].maxMisses;
  ballSpeedSetting = difficultySettings[currentDifficulty].ballSpeed;
  missedCounter.textContent = `Missed: ${missed} / ${maxMisses}`;
  running = true;
  hideGameOver();
  resetPositions(false);
}

function loop() {
  if (running) {
    update();
    draw();
  }
  requestAnimationFrame(loop);
}

// Listen to keyboard
document.addEventListener('keydown', function(e){
  if (e.key === "ArrowUp") upPressed = true;
  if (e.key === "ArrowDown") downPressed = true;
  if (!running && e.key === " " ) {
    resetGame();
  }
});
document.addEventListener('keyup', function(e){
  if (e.key === "ArrowUp") upPressed = false;
  if (e.key === "ArrowDown") downPressed = false;
});

// Listen to difficulty selector
selectDifficulty.addEventListener('change', function() {
  currentDifficulty = selectDifficulty.value;
  resetGame();
});

// Restart button click handler
restartBtn.addEventListener('click', function() {
  resetGame();
});

// Initialize and start game
currentDifficulty = selectDifficulty.value;
resetGame();
loop();
</script>
</body>
</html>
